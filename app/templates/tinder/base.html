<!doctype html>
<title>Tinder</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='tinder.css') }}">
<aside class="aside">
  <nav>
    <div class="navbar">
      <div class="profile">
        <img src="" alt="My Profile">
        <span>My Profile</span>
      </div>
    </div>
    <div class="aside-navbar">
      <div class="matches">
        <span>Matches</span>
        {% if match_count > 0 %}
        <span>{{match_count}}</span>
        {% endif %}
      </div>
      <div class="messages">
        <span>Messages</span>
        {% if message_count > 0 %}
        <span>{{message_count}}</span>
        {% endif %}
      </div>
    </div>
  </nav>
</aside>
<main class="main">
  <div class="card-container">
    {% block cards %}{% endblock %}
  </div>
  <div class="keyboard-shortcuts">
    <div class="nope">⬅️ Nope</div>
    <div class="like">➡️ Like</div>
    <div class="open-profile">⬆️ Open Profile</div>
    <div class="close-profile">⬇️ Close Profile</div>
    <div class="super-like">⏎ Super Like</div>
    <div class="next-photo">▭ Next photo</div>
  </div>
</main>

<script type="text/javascript">

  actions = document.getElementsByClassName('actions');
  for(i=0; i<actions.length; i++){
    actions[i].addEventListener('click', event => {
        event.preventDefault();
        tinder_action(event, {'id': event.target.parentElement.parentElement.id, 'action': event.target.className})
    });
  }

  function tinder_action(event, data) {
    fetch("{{tinder_action_url}}", {
      method: "POST",
      body: JSON.stringify(data),
      headers: {"content-type": "application/json"},
    }).then(function(res) {
      if (res.ok) { // ok if status is 2xx
        event.target.parentElement.parentElement.remove();
        if (document.getElementsByClassName('card-container')[0].childElementCount === 0) {
          location.reload();
        }
      } else {
        console.log('Request failed.  Returned status of ' + res.status);
      }
      return res.blob()
    })
  }
</script>